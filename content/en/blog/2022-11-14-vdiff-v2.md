---
author: 'Matt Lord'
date: 2022-11-14
slug: '2022-11-14-vdiff-v2'
tags: [Vitess','MySQL','sharding']
title: 'Vitess Diff V2'
description: "Vitess's Powerful Data Diff Tool Just Got Better"
---

Vitess is a solution that allows you to infinitely scale MySQL while providing clients and apps with a single mysqld
view of the fleet of MySQL instances that are managing N [Keyspaces](https://vitess.io/docs/concepts/keyspace/) and
Y [Shards](https://vitess.io/docs/concepts/shard/).
<a href="/img/VitessQueryExample.png"><img src="/img/VitessQueryExample.png" alt="Query Example" width="275" align="right"/></a>

Vitess also provides the cluster and data management tools that make it possible to manage a massive cluster and
perform complex workflows for [moving tables](https://vitess.io/docs/reference/vreplication/movetables/),
[resharding](https://vitess.io/docs/reference/vreplication/reshard/) to adjust to changes in data size and load,
[materialized views and rollups](https://vitess.io/docs/reference/vreplication/materialize/) for data analytics
and data locality, performing [online schema changes](https://vitess.io/docs/user-guides/schema-changes/managed-online-schema-changes/),
and more using [VReplication](https://vitess.io/docs/16.0/reference/vreplication/vreplication/).

## Why VDiff?

Data is typically one of the most critical assets within an organization. As such, an operator needs to be able to
verify the correctness of this data, in particular as the data is moved around or otherwise transformed. Even for
the relatively simple and reliable case of replicating data from one MySQL instance to another there's been a
strong desire for some kind of easy-to-use verification tool. But even for a single table in this simplest of case — 
performing a safe, reliable, light-weight, and performant diff between two MySQL instances is a suprisingly
difficult problem. Due to the challenges involved, there have been few attempted general solutions with the most
notable being:
  * Percona's [pt-table-checksum](https://docs.percona.com/percona-toolkit/pt-table-checksum.html)
  * MySQL's `mysqldiff` tool that was part of the now EOL'd [MySQL Utilities](https://downloads.mysql.com/docs/mysql-utilities-1.6-en.pdf)

With Vitess, _the need for a data diff tool is even more pronounced_ because you'll be migrating data from your legacy systems into Vitess, migrating data across different sharding schemes, and performing a host of various data transformations/materializations.  This is further complicated by the fact that these migarations may be done across MySQL versions, data centers, and with differing schemas on the source and target as your data evolves over time and is modified to e.g. support new sharding or data distribution schemes. So the need for a tool that can reliably perform a logical diff between the source and target of these data migrations and workflows — which also likely have different data sharding/partitioning schemes in place — all in a timely manner and without impacting production traffic regardless of data set size and other complicating factors becomes critical for peace of mind as you move your most valuable assets around.

## VDiff
